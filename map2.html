<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>

    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/try2.css">

  </head>
  <style media="screen">
    .mapsvg g{
      transform:translate(0px,500px);
      box-shadow: 120px 80px 40px 20px #0ff;
    }
    .mapsvg path{
      stroke:rgba(255,255,255,0.3);
      stroke-width: 1px;
      transition: all .4s ease;
    }
    .mapsvg{
      position: fixed;
top: 100px;
left: 50%;
transform: translateX(-460px) scale(0.9);
transform-origin: 50% 50%;
    }
    .mapsvg path:hover{
      stroke:white;
      stroke-width: 3px;
    }
    body{
      background-color: black;
    }
    .province-description{
      color: white;
    font-size: 26px;
    letter-spacing: 0.005rem;
    font-family: times;
    /* margin-bottom: 70px; */
    margin-top: 100px;
    margin-left: 10%;
    margin-right: 10%;
    text-align: center;
    line-height: 1.4;
    }
    .d3-tip {
     line-height: 1;
     padding: 6px;
     background: rgba(0, 0, 0, 0.8);
     color: #fff;
     border-radius: 4px;
     font-size: 12px;
   }

   /* Creates a small triangle extender for the tooltip */
   .d3-tip:after {
     box-sizing: border-box;
     display: inline;
     font-size: 10px;
     width: 100%;
     line-height: 1;
     color: rgba(0, 0, 0, 0.8);
     content: "\25BC";
     position: absolute;
     text-align: center;
   }

   /* Style northward tooltips specifically */
   .d3-tip.n:after {
     margin: -2px 0 0 0;
     top: 100%;
     left: 0;
   }
   .locateinfo{
     width:100vw;
     height: 100vh;
     background-color: rgba(0,0,0,0.9);
     position: absolute;
     top: 0;
     left: 0;
     z-index: 500;
     color: white;
     font-size: 20px;
     font-family: times;
     text-align: center;


   }
   .locateinfo p{
     margin-top: 5vh;
     margin-left: 20%;
     margin-right: 20%;
     line-height: 1.7;
     font-family: sans-serif;
     animation-name: pagebegin;
     animation-duration: 4s;

   }
   .locate{
     margin-top: 40vh;
     animation-name: pagebegin;
     animation-duration: 3s;
   }
   .button{
     margin-top: 90px;
font-family: sans-serif;
font-weight: 500;
animation-name: pagebegin;
animation-duration: 5s;
   }
   .button:hover{
     cursor: pointer;
   }
   /* .province-description{
     opacity: 0;
   } */
   @keyframes pagebegin {
     0%{
       opacity: 0
     }
     30%{
       opacity: 0
     }
     100%{
       opacity: 100%;
     }
   }
   .hreflink{
     text-align: center;
     z-index: 2000;
display: none;  }
   .hreflink a{
     color: white;

   }
  </style>
  <body>
    <div id="legend">

    </div>
    <div class="">
    </div>
    <div class="province-description">
      Click on the provinces to see single-parent families statiics.
    </div>
    <div class="hreflink">
      <a href="donation_impact.html">See how you can help these single-parent families.</a>
    </div>
    <!-- <div class="columns">
      <div class="column">
        <svg class="child_lone" width="1280" height="1500"></svg>
      </div>

    </div> -->
    <div class="locateinfo">
      <div class="locate">
        <img src="images/locateicon.png" alt="">
        <span>Vancouver, British Columbia</span>
      </div>
      <p>In the province you are living (British Columbia), according to Statistics Canada, there are 199729 (15.3%) single-parent families, 17.8% of children living in single-parent families.
</p>
<div class="button">
<u>See Statistics in Other Provinces</u>
</div>

    </div>

    <div class="logo">
      lighthouse
    </div>
    <div class="donate">
      DONATE
    </div>
    <div class="nextsectionarrow">
      <?xml version="1.0" encoding="UTF-8"?>
      <svg width="43px" height="80px" viewBox="0 0 43 159" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
          <title>Group 3</title>
          <desc>Created with Sketch.</desc>
          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.498721168" stroke-linecap="round" stroke-linejoin="round">
              <g id="Cry4" transform="translate(-1373.000000, -433.000000)" stroke="#FFFFFF" stroke-width="5">
                  <g id="Group-3" transform="translate(1374.000000, 434.000000)">
                      <path d="M0,0.24 L40.6403509,78" id="Line-10"></path>
                      <path d="M0,78.24 L40.6403509,156" id="Line-10-Copy" transform="translate(20.500000, 117.500000) scale(1, -1) translate(-20.500000, -117.500000) "></path>
                  </g>
              </g>
          </g>
      </svg>
    </div>
    <div class="nextcontent">
    See Donation Impact
    </div>
    <div class="previouscontent">
      Home
    </div>
    <div class="previoussectionarrow">
      <?xml version="1.0" encoding="UTF-8"?>
      <svg width="43px" height="80px" viewBox="0 0 43 159" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
          <title>Group 3</title>
          <desc>Created with Sketch.</desc>
          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.498721168" stroke-linecap="round" stroke-linejoin="round">
              <g id="Cry4" transform="translate(-1266.000000, -433.000000)" stroke="#FFFFFF" stroke-width="5">
                  <g id="Group-3" transform="translate(1287.500000, 512.500000) scale(-1, 1) translate(-1287.500000, -512.500000) translate(1267.000000, 434.000000)">
                      <path d="M0,0.24 L40.6403509,78" id="Line-10"></path>
                      <path d="M0,78.24 L40.6403509,156" id="Line-10-Copy" transform="translate(20.500000, 117.500000) scale(1, -1) translate(-20.500000, -117.500000) "></path>
                  </g>
              </g>
          </g>
      </svg>
    </div>
    <div class="bottomtimeline">
      <?xml version="1.0" encoding="UTF-8"?>
      <svg width="1344px" height="37px" viewBox="0 0 1344 37" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
          <title>Group 4 Copy</title>
          <desc>Created with Sketch.</desc>
          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="Cry4" transform="translate(-45.000000, -872.000000)">
                  <g id="Group-4-Copy" transform="translate(44.000000, 871.000000)">
                      <g id="Group-2">
                          <path d="M25.1469004,29.6158798 L1308.5,29.6158798" id="Line-2" stroke="#FFFFFF" opacity="0.599888393" stroke-linecap="square" transform="translate(666.500000, 29.500000) scale(1, -1) rotate(360.000000) translate(-666.500000, -29.500000) "></path>
                          <g id="Group" transform="translate(17.500000, 29.500000) scale(1, -1) rotate(360.000000) translate(-17.500000, -29.500000) translate(10.000000, 22.000000)" fill="#FFFFFF" stroke="#FFFFFF">
                              <circle id="Oval" cx="7.22785798" cy="7.22785798" r="7.22785798"></circle>
                          </g>
                          <g id="Group-Copy-2" opacity="0.599818638" transform="translate(1114.500000, 29.500000) scale(1, -1) rotate(360.000000) translate(-1114.500000, -29.500000) translate(1107.000000, 22.000000)" fill="#000000" stroke="#FFFFFF" stroke-width="1.5">
                              <circle id="Oval" cx="7.22785798" cy="7.22785798" r="7.22785798"></circle>
                          </g>
                          <g id="Group-Copy-4" opacity="0.599818638" transform="translate(919.500000, 29.500000) scale(1, -1) rotate(360.000000) translate(-919.500000, -29.500000) translate(912.000000, 22.000000)" fill="#000000" stroke="#FFFFFF" stroke-width="1.5">
                              <circle id="Oval" cx="7.22785798" cy="7.22785798" r="7.22785798"></circle>
                          </g>
                          <g id="Group-Copy-3" opacity="0.599818638" transform="translate(1308.500000, 29.500000) scale(1, -1) rotate(360.000000) translate(-1308.500000, -29.500000) translate(1301.000000, 22.000000)" fill="#000000" stroke="#FFFFFF" stroke-width="1.5">
                              <circle id="Oval" cx="7.22785798" cy="7.22785798" r="7.22785798"></circle>
                          </g>
                          <text id="MARIA’S-STORY" font-family="SFUIText-Bold, SF UI Text" font-size="12" font-weight="bold" letter-spacing="1.03999996" fill="#FFFFFF">
                              <tspan x="140" y="11">MARIA’S STORY</tspan>
                          </text>
                          <text id="HOME" font-family="SFUIText-Regular, SF UI Text" font-size="10" font-weight="normal" letter-spacing="0.8666667" fill="#FFFFFF">
                              <tspan x="0.852115819" y="11">HOME</tspan>
                          </text>
                          <text id="THE-MAP" opacity="0.599818638" font-family="SFUIText-Regular, SF UI Text" font-size="10" font-weight="normal" letter-spacing="0.8666667" fill="#FFFFFF">
                              <tspan x="890" y="10">THE MAP</tspan>
                          </text>
                          <text id="DONATION-IMPACT" opacity="0.599818638" font-family="SFUIText-Regular, SF UI Text" font-size="10" font-weight="normal" letter-spacing="0.8666667" fill="#FFFFFF">
                              <tspan x="1061" y="10">DONATION IMPACT</tspan>
                          </text>
                          <text id="DONATE-NOW" opacity="0.599818638" font-family="SFUIText-Regular, SF UI Text" font-size="10" font-weight="normal" letter-spacing="0.8666667" fill="#FFFFFF">
                              <tspan x="1269" y="10">DONATE NOW</tspan>
                          </text>
                          <g id="Group-Copy" transform="translate(340.500000, 29.500000) scale(1, -1) rotate(360.000000) translate(-340.500000, -29.500000) translate(333.000000, 22.000000)"></g>
                          <g id="Group-Copy-6" transform="translate(473.000000, 30.000000) scale(1, -1) rotate(360.000000) translate(-473.000000, -30.000000) translate(468.000000, 25.000000)"></g>
                          <g id="Group-Copy-7" transform="translate(538.000000, 30.000000) scale(1, -1) rotate(360.000000) translate(-538.000000, -30.000000) translate(533.000000, 25.000000)"></g>
                          <g id="Group-Copy-8" transform="translate(602.000000, 30.000000) scale(1, -1) rotate(360.000000) translate(-602.000000, -30.000000) translate(597.000000, 25.000000)"></g>
                          <g id="Group-Copy-11" transform="translate(667.000000, 30.000000) scale(1, -1) rotate(360.000000) translate(-667.000000, -30.000000) translate(662.000000, 25.000000)"></g>
                          <g id="Group-Copy-10" transform="translate(732.000000, 30.000000) scale(1, -1) rotate(360.000000) translate(-732.000000, -30.000000) translate(727.000000, 25.000000)"></g>
                          <g id="Group-Copy-9" transform="translate(504.500000, 29.500000) scale(1, -1) rotate(360.000000) translate(-504.500000, -29.500000) translate(185.000000, 22.000000)" stroke="#FFFFFF" stroke-width="1.5">
                              <circle id="7" fill="#000000" opacity="0.600144159" cx="633.818572" cy="6.81857199" r="4.81857199"></circle>
                              <circle id="6" fill="#000000" opacity="0.600144159" cx="544.818572" cy="6.81857199" r="4.81857199"></circle>
                              <circle id="5" fill="#000000" opacity="0.600144159" cx="455.818572" cy="6.81857199" r="4.81857199"></circle>
                              <circle id="4" fill="#000000" opacity="0.600144159" cx="365.818572" cy="6.81857199" r="4.81857199"></circle>
                              <circle id="3" fill="#000000" opacity="0.600144159" cx="276.818572" cy="6.81857199" r="4.81857199"></circle>
                              <circle id="2" fill="#000000" opacity="0.600144159" cx="187.818572" cy="6.81857199" r="4.81857199"></circle>
                              <circle id="1" fill="#000000" opacity="0.600144159" cx="98.818572" cy="6.81857199" r="4.81857199"></circle>
                              <circle id="start" fill="#FFFFFF" cx="7.22785798" cy="7.22785798" r="7.22785798"></circle>
                          </g>
                      </g>
                  </g>
              </g>
          </g>
      </svg>
    </div>

<script>
//text aimation
$('.button').click(function(){
  $('.province-description').each(function(){
    $(this).html($(this).text().replace(/[-A-Za-z0-9!$%^&*@()_+|~=`{}\[\]:";'<>?,.\/]/g, "<span class='letter'>$&</span>"));
  });
  anime.timeline({loop: false})
    .add({
      targets: '.province-description .letter',
      opacity: [0,1],
      easing: "easeInOutQuad",
      duration: 500,
      delay: function(el, i) {
        return 50 * (i+1)
      }
    });
  $('.locateinfo').animate({
    opacity:0
  },800,"linear",function(){
    $('.locateinfo').hide();
  })
});



//data vis code
var child_domain = [14, 18, 22, 26, 30];
// var child_color = d3.scaleThreshold()
//     .domain(child_domain)
//     .range(d3.schemeYlGn[6]);
var child_color = d3.scaleThreshold()
    .domain(child_domain)
    .range(['#E2EDE8','#CDDAE1','#C2D0DE','#B5C4DA','#A6B6D5','#899FCE']);
    var child_color_highlight = d3.scaleThreshold()
        .domain(child_domain)
        .range(['#EFF8F4','#DCE7ED','#D4DCE4','#CAD5E4','#C0CCE4','#A4B6DB']);
  var child_inlone_data = d3.map();
  var percent_lone = d3.map();
  var num_lone=d3.map();
  var province_des=d3.map();
  var child_lone_url="https://gist.githubusercontent.com/kristine919717/f1cb7559c0b097d694232ec5d260857e/raw/a5a773b96451bea7dc6b188176fb391f0f483363/percent_lonefamily.csv";
  var percent_lone_url="https://gist.githubusercontent.com/kristine919717/95c7671958a5a57550988e34aeec04f2/raw/e2a8936fc7e06502e45e4d33db4c91f2a9bd3b7c/percent_lone.csv";
  var num_lone_url="https://gist.githubusercontent.com/kristine919717/6f4655cfceebf1d0116618fdfd495085/raw/bf54eddfe7b5bd83be450196ec0541fe243d5f70/num_lonefamily.csv";
  var province_des_url="https://gist.githubusercontent.com/kristine919717/3b7e05c02e377e33413ddadb55a8e992/raw/90770c25d8cc4d2fdab08dd22d6f1b4961c50f51/province_des.csv";
  d3.queue()
    .defer(d3.csv, child_lone_url, function(d){
          child_inlone_data.set(d.Province, +d["Percent_child_in_lone"],d.Description, +d["num_lonefamily"], +d["percent_lone"]);
    })
    .defer(d3.csv, percent_lone_url, function(d){
          percent_lone.set(d.Province,+d["percent_lone"]);
    })
    .defer(d3.csv, num_lone_url, function(d){
          num_lone.set(d.Province,+d["num_lonefamily"]);
    })
    .defer(d3.csv, province_des_url, function(d){
          province_des.set(d.Province,d["Description"]);
    })
    var canvas = d3.select("body").append("svg")
    .attr("width",960)
    .attr("height", 960)
    .attr("class","mapsvg")
  var group;
  var projection = d3.geoAlbers();
  var path = d3.geoPath().projection(projection);
  // d3.csv(child_lone_url, function(child_data){
  //   child_data.forEach(function(d) {
  //     d["Percent_child_in_lone"] = +d["Percent_child_in_lone"];
  //     d["num_lonefamily"] = +d["num_lonefamily"];
  //
  //
  //     console.log(d);
  //   });
  // });
  d3.json("https://gist.githubusercontent.com/kristine919717/ee0fc3a3ee5c9f346121b9918355d9fe/raw/dd616bbc0430fe3e55baa404906ddc30066b4e0b/gpr_000b11a_e%2520(1).json", function(data){
     group = canvas.selectAll("g")
      .data(data.features)
      .enter()
      .append("g")

var tip = d3.tip()
  .attr('class','d3-tip')
  .offset([-10, 0])
  .html(function(d){
    return "<strong>"+d.properties.PRENAME+"</strong>"
  });

    var area = group.append("path")
      .attr("d", path)
      .attr("class", "area")
      .attr("fill", function(d){
        var value = percent_lone.get(d.properties.PRENAME);
        return (value != 0 ? child_color(value) : "lightblue");
        // return child_color(d["percent_lone"] = percent_lone.get(d.properties.PRENAME))
      })
      .on('mouseover', tip.show)
      .on('click', function(d){
        d3.select(".province-description")
          .html("In " +d.properties.PRENAME +"  <span>, there are " +
          num_lone.get(d.properties.PRENAME) +
          " ("+percent_lone.get(d.properties.PRENAME)+
          "%) single-parent families, "+child_inlone_data.get(d.properties.PRENAME)
          +"% of children living in single-parent families. "+province_des.get(d.properties.PRENAME)+"</span>"
      )
    })
      .on('mouseout', tip.hide);
$("path").click(function(){
  $('.hreflink').show()
  $('.province-description').each(function(){
    $(this).html($(this).text().replace(/[-A-Za-z0-9!$%^&*@()_+|~=`{}\[\]:";'<>?,.\/]/g, "<span class='letter'>$&</span>"));
  });
  anime.timeline({loop: false})
    .add({
      targets: '.province-description .letter',
      opacity: [0,1],
      easing: "easeInOutQuad",
      duration: 500,
      delay: function(el, i) {
        return 25 * (i+1)
      }
    });
})
group.call(tip);
    // group.append("svg:text")
    //   .attr("x", function(d){return path.centroid(d)[0];})
    //   .attr("y", function(d){return path.centroid(d)[1];})
    //   .text(function(d){return d.properties.PRENAME;})

// var w = 260,
//     h = 40,
//     key = d3.select('#legend')
//     .append('svg')
//     .attr('width', w)
//     .attr('height', h),
//     legend= key.append('defs')
//     .append('svg: linearGradient')
//     .attr('id', 'gradient')
//     .attr('y1', '100%')
//     .attr('x1','0%')
//     .attr('y2', '100%')
//     .attr('x2', '100%')
// legend.append('stop')
//   .attr('offset','0%')
//   .attr('stop-color','#E2EDE8')
// legend.append('stop')
//   .attr('offset', '100%')
//   .attr('stop-color','#97A9D0')
// key.append('rect')
//   .attr('width',w-10)
//   .attr('height',h-20)
//   .style('fill','url(#gradient)')
//   .attr('transform', 'translate(0,0)');
  });

  // var color = d3.scale.linear()
  // .domain([0, 5])
  // .range(["blue", "green"]);
  // var percent_child_in_lone = d3.scale.linear()
  // .domain([0, 5])
  // .range([16, 25]);
    // .defer(d3.json, "https://gist.githubusercontent.com/kristine919717/f0c0089716745706c267a25780204112/raw/0bf1568fa11b27c9040de2ca6cf7a83a6e81d2a0/gpr_000b11a_e%2520(4).json")
    // // callback function
    // function ready(error, data) {
    //
    //     if (error) throw error;
    //
    //     // province topojson
    //     var canada_province = topojson.feature(data, {
    //         type: "GeometryCollection",
    //         geometries: data.objects.gpr_000b11a_e.geometries
    //     });
    //
    //     // projection and path
    //     var projection = d3.geo.albers();
    //
    //     var geoPath = d3.geoPath()
    //         .projection(projection);
    //
    //     // draw new york map and bind income data
    //     d3.select("svg.child_lone").selectAll("path")
    //         .data(canada_province.features)
    //         .enter()
    //         .append("path")
    //         .attr("d", geoPath)
    //         .attr("fill", "green");
        //     .transition().duration(2000)
        //     .delay(function(d, i) {
        //         return i * 5;
        //     })
        //     .ease(d3.easeLinear)
        //     .attr("fill", function(d) {
        //         var value = incomeData.get(d.properties.GEOID);
        //         return (value != 0 ? income_color(value) : "lightblue");
        //
        //     })
        //     .attr("class", "counties-income");
        //
        // // title
        // d3.select("svg.income").selectAll("path")
        //     .append("title")
        //     .text(function(d) {
        //         return d.income = incomeData.get(d.properties.GEOID);
        //     });
        //
        // // draw new york map and bind poverty data
        // d3.select("svg.poverty").selectAll("path")
        //     .data(new_york.features)
        //     .enter()
        //     .append("path")
        //     .attr("d", geoPath)
        //     .attr("fill", "white")
        //     .transition().duration(2000)
        //     .delay(function(d, i) {
        //         return i * 5;
        //     })
        //     .ease(d3.easeLinear)
        //     .attr("fill", function(d) {
        //         var value = povertyData.get(d.properties.GEOID);
        //         return (value != 0 ? poverty_color(value) : "lightblue");
        //
        //     })
        //     .attr("class", "counties-poverty");
        //
        // // title
        // d3.select("svg.poverty").selectAll("path")
        //     .append("title")
        //     .text(function(d) {
        //         return d.income = incomeData.get(d.properties.GEOID);
        //     });
    // }


</script>

  </body>
</html>
